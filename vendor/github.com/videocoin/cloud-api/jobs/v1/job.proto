syntax = "proto3";

package cloud.api.jobs.v1;

import "github.com/gogo/protobuf/gogoproto/gogo.proto";
import "github.com/videocoin/cloud-api/profiles/v1/profiles.proto";

option go_package = "v1";
option (gogoproto.marshaler_all) = true;
option (gogoproto.unmarshaler_all) = true;
option (gogoproto.sizer_all) = true;
option (gogoproto.goproto_registration) = true;
option (gogoproto.messagename_all) = true;

enum JobStatus {
    option (gogoproto.goproto_enum_prefix) = false;
    option (gogoproto.enum_customname) = "JobStatus";

    JOB_STATUS_NONE = 0 [ (gogoproto.enumvalue_customname) = "JobStatusNone" ];
    JOB_STATUS_NEW = 1 [ (gogoproto.enumvalue_customname) = "JobStatusNew" ];
    JOB_STATUS_PREPARING = 2 [ (gogoproto.enumvalue_customname) = "JobStatusPreparing" ];
    JOB_STATUS_PREPARED = 3 [ (gogoproto.enumvalue_customname) = "JobStatusPrepared" ];
    JOB_STATUS_PENDING = 4 [ (gogoproto.enumvalue_customname) = "JobStatusPending" ];
    JOB_STATUS_PROCESSING = 5 [ (gogoproto.enumvalue_customname) = "JobStatusProcessing" ];
    JOB_STATUS_READY = 6 [ (gogoproto.enumvalue_customname) = "JobStatusReady" ];
    JOB_STATUS_COMPLETED = 7 [ (gogoproto.enumvalue_customname) = "JobStatusCompleted" ];
    JOB_STATUS_CANCELLED = 8 [ (gogoproto.enumvalue_customname) = "JobStatusCancelled" ];
    JOB_STATUS_FAILED = 9 [ (gogoproto.enumvalue_customname) = "JobStatusFailed" ];
}

enum InputStatus {
    option (gogoproto.goproto_enum_prefix) = false;
    option (gogoproto.enum_customname) = "InputStatus";

    INPUT_STATUS_NONE = 0 [ (gogoproto.enumvalue_customname) = "InputStatusNone" ];
    INPUT_STATUS_PENDING = 1 [ (gogoproto.enumvalue_customname) = "InputStatusPending" ];
    INPUT_STATUS_ACTIVE = 2 [ (gogoproto.enumvalue_customname) = "InputStatusActive" ];
    INPUT_STATUS_ERROR = 3 [ (gogoproto.enumvalue_customname) = "InputStatusError" ];
}

message Job {
    string id = 1 [
        (gogoproto.moretags) = "gorm:\"type:char(36);\""
    ];

    bytes chunks = 2 [
        (gogoproto.moretags) = "gorm:\"chunks;type:json\"sql:\"type:json\""
    ];

    bytes worker = 3 [
        (gogoproto.moretags) = "gorm:\"worker;type:binary(32);DEFAULT:NULL\"sql:\"type:binary(32);DEFAULT:null\""
    ];

    string pipeline_id = 4;
    cloud.api.profiles.v1.ProfileId profile_id = 6;
    string client_address = 7;
    string stream_address = 8;
    int64 stream_id = 9;
    string transcode_input_url = 10;
    string ingest_input_url = 11;
    string transcode_output_url =12;
    JobStatus status = 13;
    int64 created_at = 14;
    int64 updated_at = 15;
    int64 ready_at = 16;
    int64 completed_at = 17;
    bool refunded = 18;
    InputStatus input_status = 19;
    string user_id = 20;
}

message Jobs {
    repeated Job items = 1;
}


message JobProfile {
    string id = 1;
    string pipeline_id = 2;

    string ingest_input_url = 4;
    string transcode_output_url = 5;

    int64 stream_id = 7;
    string stream_address = 8;

    JobStatus status = 9;
    InputStatus input_status = 10;

    int64 created_at = 11;
    int64 updated_at = 12;
    int64 ready_at = 13;
    int64 completed_at = 14;
}

message JobProfiles {
    repeated JobProfile items = 1;
}
